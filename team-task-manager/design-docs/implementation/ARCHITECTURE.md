<!-- ProjectFlow 系統架構與技術設計，包括前端 React/Vite/Zustand、後端 Node.js/Express/PostgreSQL、國際化設計、Docker 資料庫環境、檔案管理 API、開發測試流程，以及 CI/CD 結構規劃。 -->

### **全端應用架構升級設計說明 (修訂版)**

#### **1. 總體目標**

本次設計旨在將現有的前端任務管理器 (`team-task-manager`) 升級為一個功能完整、可擴展、安全且支援多產品線的全端 Web 應用程式。此架構將保留現有技術棧的優點（React, TypeScript, Vite），並引入強健的後端服務、資料庫和雲端整合，以滿足未來的業務增長需求。

#### **2. 設計方案詳解**

**2.1. 多語系架構 (Multi-language)**

*   **現狀分析:** 專案已採用 `i18next` 和 `react-i18next`，並成功實現了中、英、日文切換。這是一個非常好的基礎。
*   **設計方案:**
    1.  **擴展語言包:** 在 `public/locales/` 目錄下，按照 `i18next` 的標準格式新增韓文 (`ko-KR.json`)、越南文 (`vi-VN.json`) 等語言的翻譯文件。
    2.  **動態加載:** 維持現有的語言包異步加載機制，確保新增語言不會影響初始頁面加載速度。
    3.  **UI 更新:** 修改 `src/components/LanguageSelector.tsx` 組件，將新的語言選項加入到下拉列表中。
    4.  **中心化管理:** 當語系文件變得龐大時，考慮引入一個翻譯管理平台（如 Tolgee, Lokalise 的免費方案），透過 API 來管理和同步翻譯內容，簡化維護流程。

**2.2. 使用者認證系統 (Authentication)**

*   **現狀分析:** 目前僅為一個模擬的本地用戶切換器，並無實際的用戶註冊和登入功能。
*   **設計方案:**
    1.  **後端服務:** 建立一個新的 Node.js 後端服務（使用 Express.js 或 NestJS 框架），專門處理用戶認證。
    2.  **資料庫:** 引入 **PostgreSQL** 作為用戶資料庫。它免費、開源且功能強大，足以應對未來需求。我們將建立一個 `users` 資料表，儲存用戶 ID、用戶名、電子郵件和經過 **bcrypt** 加密的密碼。
    3.  **認證機制:** 採用 **JWT (JSON Web Tokens)** 進行無狀態認證。
        *   **註冊 (`/api/auth/register`):** 接收用戶資料，加密密碼後存入資料庫。
        *   **登入 (`/api/auth/login`):** 驗證用戶憑證，成功後生成 JWT 並返回給前端。
        *   **忘記密碼 (`/api/auth/forgot-password`):** 生成一個有時效性的重設密碼連結，並透過郵件服務（如 SendGrid 的免費方案）發送給用戶。
    4.  **前端整合:**
        *   創建新的路由和頁面：`/login`, `/register`, `/forgot-password`。
        *   用戶登入成功後，將 JWT 儲存在 `localStorage` 或安全的 `HttpOnly` Cookie 中。
        *   修改 `appStore.ts` (Zustand)，將 `currentUser` 的狀態與 JWT 的驗證結果同步，而非從靜態列表讀取。

**2.3. 台灣法規遵循 (Legal Compliance)**

*   **設計方案:**
    1.  **隱私權政策頁面:** 新增一個靜態路由 `/privacy-policy`，展示符合台灣《個人資料保護法》的隱私權政策條款。
    2.  **Cookie 同意橫幅:** 在應用程式首次加載時，顯示一個 Cookie 同意橫幅。可以使用 `react-cookie-consent` 等開源組件快速實現，告知用戶網站將使用的 Cookie類型。
    3.  **數據安全:**
        *   **儲存加密:** 用戶密碼必須使用 `bcrypt` 進行單向雜湊加密。
        *   **用戶數據權利:** 在用戶個人資料頁面，提供 "匯出個人資料" 和 "刪除帳號" 的功能選項，後端需實現對應的 API 來處理這些請求。

**2.4. 免費小型資料庫整合**

*   **設計方案:**
    1.  **主要資料庫 (PostgreSQL):** 如上所述，用於儲存核心業務資料，如用戶、任務、專案等。它提供完整的關聯式數據能力，並且有許多免費的雲端託管選項（如 Supabase, Neon, Heroku）。
    2.  **快取/緩存資料庫 (Redis):** 引入 Redis 作為一個高速的內存資料庫。它非常適合用於：
        *   **Session 儲存:** 儲存用戶登入狀態或臨時數據。
        *   **API 快取:** 緩存不常變動的數據庫查詢結果，降低主資料庫負載。
        *   **排行榜/計數器:** 實現即時性要求高的功能。
        Redis 也有許多提供免費額度的雲端服務。
    3.  **任務數據遷移:** 現有的任務管理邏輯將從 `localStorage` 遷移至後端的 PostgreSQL 資料庫，並與 `users` 表關聯。

**2.5. "ai" 與 "AUS" 雙產品線架構**

*   **設計方案:**
    1.  **URL 路由策略:**
        *   在前端路由中劃分產品命名空間，例如：
            *   AI 產品: `/ai/dashboard`, `/ai/settings`
            *   AUS 產品: `/aus/kanban`, `/aus/reports`
        *   這樣可以清晰地將不同產品的功能模組隔離開。
    2.  **程式碼結構:**
        *   在 `src/` 目錄下建立 `features` 文件夾，用於存放特定產品的業務邏輯和組件：
            ```
            src/
            ├── features/
            │   ├── ai/
            │   │   ├── components/
            │   │   └── routes/
            │   ├── aus/
            │   │   ├── components/
            │   │   └── routes/
            └── components/ (存放共用組件)
            ```
    3.  **資料庫模型:**
        *   在核心的資料表中（如 `tasks`, `projects`），增加一個 `product_line` 字段（`'ai'` 或 `'aus'`）。
        *   這樣，後端 API 可以根據用戶當前所在的產品線（從 URL 或請求中獲取）來過濾和提供對應的數據。
    4.  **狀態管理 (Zustand):**
        *   在 `appStore` 中增加一個 `currentProduct` 狀態，用於標識用戶當前正在使用的產品。UI 和數據請求可以根據此狀態動態調整。

---

#### **3. 待開發項目 (Future Development)**

以下項目已記錄，將在未來的開發階段中實施：

*   **全站強制 HTTPS:** 部署時配置 Web 伺服器或負載均衡器，強制所有 HTTP 請求跳轉至 HTTPS。
*   **網頁檔案上傳功能:** 包含前端上傳組件、後端接收 API 以及與雲端對象儲存（如 Cloudflare R2）的整合。
